<?xml version="1.0" encoding="UTF-8"?>
<project name="core" default="all" basedir="../">
 
    <target name="preBuild"
        description="Avant deploiement"
        depends="prepareBuildDirectory"
    />
    
    <target name="postBuild"
        description="Aprés déploiement"
        depends="editDeployedArtifacts"
    />
 
    <target name="prepareBuildDirectory" description="Ajuste les permissions après le déploiement">
        <echo msg="Donner les permission à Jenkins sur ${exportdir}" />
        <exec command="chown -R jenkins ${exportdir}" escape="false" />
    </target>
 
    <target name="editDeployedArtifacts" description="Ajuste les permissions après le déploiement">
         <echo msg="Configurer les permissions sur le dossier tmp/" />         
         <exec command="chmod -R 777 ${exportdir}/tmp/" escape="false" />
        <echo msg="Restaurer les droits sur les fichiers à Jenkins pour le prochain deploiement" />         
        <exec command="chown -R jenkins:jenkins ${exportdir}" escape="false" />    	
		<echo msg="Permissions sur le fichier des logs apache2" />         
		<exec command="chmod -R 777 ${exportdir}/tmp/" escape="false" />  
         <echo msg="Créer le fichier pour stocker les logs serveurs (Apache2)" />         
         <exec command="touch ${exportdir}/tmp/logs/server-errors.log" escape="false" />
    </target>
 
<!--    <target name="runUnitTest" description="Run les tests unitaires">
         <echo msg="Lancement des tests unitaire ( /!\ devrai etre en escape=true et avant le deploiement)" />                 
          <exec command="phpunit ${exportdir}/tests/" escape="false" />
    </target>
-->    
</project>
