#!/bin/bash
# @todo usefull command like clear-cache install update pull pull-core pull-bundles .............. :)

echo "sociableCore framework v1.0"

SCURSPATH="$(pwd)"

PS3='Run a command (type 8 for help)'
options=("clear-cache-client" "clear-tmp" "install" "update" "pull" "pull-core" "pull-bundle" "help" "quit")
select opt in "${options[@]}"
do
    case $opt in
        "pull-bundle")
            echo "Let's commit that awesome code right to those bundles repositories!"
            cd ./bundles/
            for path in ./*; 
            do
                [ -d "${path}" ] || continue # if not a directory, skip
                sBundleDirName="$(basename "${path}")"
                if [[ $sBundleDirName != "composer" ]]
                    then
                    SCOMMITMSG="Auto generated commit message for $sBundleDirName by sociableCore framework console app"
                    echo "Envoi des modifications du bundle $sBundleDirName en cours"
                    cd $SCURSPATH/$SBUNDLEDIRNAME/bundles/ && git commit -am '$SCOMMITMSG' && git push origin master
                    #echo "cd $SBUNDLEDIRNAME/ && git commit -am '$SCOMMITMSG' && git push origin master && cd ./../"
                fi
            done
            echo "Tout les bundles sont désormais correctement versionnés ou en statut de pull-request. Merci -.-"
            ;;
        "option 2")
            echo "you chose choice 2"
            ;;
        "clear-cache-client")
            echo "Suppresion du cache client pour tout les bundles."
            sudo rm -fR ./../tmp/cache/*
            ;;
        "help")
            echo "1) clear-cache-client  4) update        7) pull-bundle"
            echo "2) clear-tmp           5) pull          8) help"
            echo "3) install             6) pull-core     9) quit"
            ;;
        "quit")
            break
            ;;
        *) echo invalid option;;
    esac
done